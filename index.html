<!DOCTYPE html>
<html lang="en">
<head>
<title>Foursquare and Google Maps, together!</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<link href="http://code.google.com/apis/maps/documentation/javascript/examples/standard.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script type="text/javascript">
var directionDisplay;
var directionsService = new google.maps.DirectionsService();
var map;
var route;
var response;
var markerArray = [];

function initialize() {
  directionsDisplay = new google.maps.DirectionsRenderer();
  var chicago = new google.maps.LatLng(33.850033, -83.6500523);
  var myOptions = {
    zoom:9,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    center: chicago
  }
  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
  directionsDisplay.setMap(map);
}
  
function calcRoute() {
  var start = document.getElementById("start").value;
  var end = document.getElementById("end").value;
  var request = {
    origin:start, 
    destination:end,
    travelMode: google.maps.DirectionsTravelMode.DRIVING
  };
  directionsService.route(request, function(result, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(result);
      var paths = result.routes[0].overview_path
      var steps = Math.floor(paths.length/10);
      for(var i=0;i < paths.length/steps ;i++){
        markerArray[i] = paths[i*steps];
        // var marker = new google.maps.Marker({
        //   position: paths[i*steps],
        //   map: map
        // });
      }
      getVenues();
    }
  });

}

function getVenues()
{
  var token = "PU3PIXHAQP1U201LR4F210WDL4NYZNJJPY1JJ0U2Q0Y0XSDO";
  var latlng = markerArray[0].va + "," + markerArray[0].wa;
  var venue = $("#venue").val();
  var url = "https://api.foursquare.com/v2/venues/search"
  var query = "?limit=1&query="+venue+"&ll="+latlng+"&oauth_token="+token;

  console.log(url + query);

  $.get(url + query,function(resp){
    console.log(resp);
    response = resp;
    var items = resp.response.groups[0].items
    for(var i=0;i < items.length; i++){
      var location = items[i].location;
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(location.lat, location.lng),
        map: map,
        title: items[i].name
      });
    }
  });
}



</script>
</head>
<body onload="initialize()">
  <div>
    <label>From:  <input id="start" type="textbox" value="Atlanta, GA" /></label>
    <label>To:    <input id="end" type="textbox" value="Alpharetta, GA" /></label>
    <label>Venue: <input id="venue" type="textbox" /></label>
    <input type="button" value="Go" onclick="calcRoute()">
  </div>
<div id="map_canvas" style="height:90%"></div>

<a href="https://foursquare.com/oauth2/authenticate?client_id=0Y432GMNCITEH3HUGBRHAGVHYKWGGNZ3CBEGOFOTIWSRHITK&response_type=token&redirect_uri=http://webfadi.com/fourmaps">Click to Login</a>
</body>

</html>

